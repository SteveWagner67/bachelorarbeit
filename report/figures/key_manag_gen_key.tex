\input{../template/macros}

\documentclass{article}


%%=====================================================================================
%% drawing tikz
%%=====================================================================================
%
\usepackage{tikz}
\usetikzlibrary{positioning,shapes,arrows}%
\tikzstyle{memblock} = [draw, fill=blue!20, rectangle, 
    minimum height=6em, minimum width=3em]%
\definecolor{mygray}{cmyk}{0,0,0,0.4}%
\definecolor{mydarkgray}{cmyk}{0,0,0,0.7}%
\definecolor{mylightgray}{cmyk}{0,0,0,0.1}%

%________________________________________________________________
%tikz flow chart
\tikzstyle{decision} = [diamond, draw, fill=blue!20, 
    text width=4.25em, text badly centered, node distance=2cm, inner sep=0pt]
\tikzstyle{block} = [rectangle, draw, fill=blue!20, 
     text centered, rounded corners, minimum height=1.5em] 
     
\tikzstyle{block2} = [rectangle, draw, fill=orange!20, 
     text centered, rounded corners, minimum height=1.5em] 
     
\tikzstyle{block3} = [rectangle, draw, fill=green!20, 
     text centered, rounded corners, minimum height=1.5em] 
     
\tikzstyle{rect} = [rectangle, draw, fill=blue!20, text centered, minimum
height=1.5em, minimum width=5em]
    
    
    
\tikzstyle{line} = [draw, -latex']
\tikzstyle{cloud} = [draw, ellipse,fill=red!20, node distance=2cm,
    minimum height=1em]
    
\tikzstyle{txtblk} = [above, text centered]

% Define the layers to draw the diagram
\pgfdeclarelayer{background}
\pgfdeclarelayer{foreground}
\pgfsetlayers{background,main,foreground}

\usepackage[margin=0.5cm]{geometry}

\begin{document}

\begin{tikzpicture}[node distance=3cm]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% APPLICATION				  %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\node (app) at(0.5\textwidth,0) [txtblk] {\large{Application}};

% This allow to create the rectangle
\begin{pgfonlayer}{background}
	  
  	%create  the lines of the rectangle  with an offset (x,y)         
	\path (app.west |- app.north)+(-2,0.25) node (a) {};
  	\path (app.south -|  app.east)+(2,-1) node (b) {};      
          
    % Combine the twos nodes above for creating the rectangle      
    \path[fill=blue!20,rounded corners, draw=black!50, dashed]
    (a) rectangle (b);  
            
\end{pgfonlayer}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% INTERFACE					  %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\path (app.south)+(0, -4) node (int) [txtblk] {\large{Interface}};

\path (int.east)+(1.25, -0.25) node (text22) [txtblk] {\scriptsize{ID x: Key}};

% This allow to create the rectangle
\begin{pgfonlayer}{background}
	  
  	%create  the lines of the rectangle  with an offset (x,y)         
	\path (int.west |- int.north)+(-2.25,0.25) node (c) {};
  	\path (int.south -|  int.east)+(2.25,-0.25) node (d) {};      
          
    % Combine the twos nodes above for creating the rectangle      
    \path[fill=blue!20,rounded corners, draw=black!50, dashed]
    (c) rectangle (d);  
            
\end{pgfonlayer}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% PROVIDER					  %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\path (int.south)+(0, -3.5) node (prov) [txtblk] {\large{Provider}};

\path (prov.east)+(0.5,0.35) node (text23) [txtblk] {\footnotesize{Key}};

% This allow to create the rectangle
\begin{pgfonlayer}{background}
	  
  	%create  the lines of the rectangle  with an offset (x,y)         
	\path (prov.west |- prov.north)+(-2.25,0.75) node (e) {};
  	\path (prov.south -|  prov.east)+(2.25,-0.25) node (f) {};      
          
    % Combine the twos nodes above for creating the rectangle      
    \path[fill=blue!20,rounded corners, draw=black!50, dashed]
    (e) rectangle (f);  
            
\end{pgfonlayer}


\def\underleftApp{(0.5,-0.25)}

\def\underleftInt{(0.5,-3.25)}


%Application -- Interface
\path [draw, ->] \underleftApp+(8.5,-0.75)  -- (9,-3.2);
\path (app.south)+(-1.25,-0.5) node (text4) [txtblk] {\footnotesize{Generate}};

\path(text4.south)+(0,-0.35) node(text20) [txtblk] {\footnotesize{Key}};



\path [draw, <-] \underleftApp+(11.25 ,-0.75)  -- (11.75,-3.2); 
\path (text4.east)+(2,-0.3) node (text6) [txtblk] {\footnotesize{Key}};

\path (text6.south)+(0,-0.25) node (text21) [txtblk] {\footnotesize{ID x}};


%Interface -- Provider
\path [draw, ->] \underleftInt+(8.5,-1)  -- (9,-6.2);

\path [draw, <-] \underleftInt+(11.25,-1)  -- (11.75,-6.2);


\end{tikzpicture}

\end{document}